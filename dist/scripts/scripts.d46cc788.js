"use strict";angular.module("urbnApp",["ngResource","ngRoute","ui.bootstrap","urbnApp.services","ngAnimate","ngSanitize"]).config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix(""),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/finish",{templateUrl:"views/finish.html",controller:"FinishCtrl"}).when("/play",{templateUrl:"views/wikiGame.html",controller:"WikiGameCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}]).constant("Config",{appName:"Get to the Chopper!",appVersion:1,apiUrl:"https://en.wikipedia.org/api/rest_v1",targetArticle:"Helicopter"}),angular.module("urbnApp").controller("MainCtrl",["$scope","WikiRandom","Config","$window",function(a,b,c,d){function e(){a.ready=!1,a.playBtnUrl="#/",b.get().$promise.then(function(b){try{a.playBtnUrl="#/play?title="+btoa(b.items[0].title),d.sessionStorage.removeItem("history")}catch(c){console.error(b.items[0].title),e()}a.ready=!0},function(a){console.error(a),window.location.href="404.html"})}a.gameName=c.appName,a.goal=c.targetArticle,e()}]),angular.module("urbnApp").controller("FinishCtrl",["$window","Config","$scope","$location",function(a,b,c,d){if(angular.isDefined(a.sessionStorage.history)){var e=JSON.parse(a.sessionStorage.history);e[e.length-1].title===b.targetArticle?c.solution=e:d.path("/")}else d.path("/")}]),angular.module("urbnApp").controller("WikiGameCtrl",["$scope","$window","WikiPage","$compile","$location","Config",function(a,b,c,d,e,f){function g(){var b=e.search();angular.isDefined(b.title)?a.getPage(atob(b.title)):e.path("#/")}var h=null;a.getPage=function(d){null===h&&(h=angular.isDefined(b.sessionStorage.history)?JSON.parse(b.sessionStorage.history):[]),a.article={},a.article.title=d,c.get({title:d}).$promise.then(function(c){a.article.html=c.html,(0===h.length||h.length>0&&h[h.length-1].title!==d)&&h.push({title:d}),a.history=h,b.sessionStorage.history=JSON.stringify(a.history)},function(a){window.location.href="404.html",console.error(a)})},a.goal=f.targetArticle,g(),a.$on("$routeUpdate",function(){g()})}]).filter("pretty",function(){return function(a){if("undefined"!=typeof a){var b=a.replace(/_/g," ");return b}return a}}),angular.module("urbnApp.services",[]).factory("WikiRandom",["$resource","Config",function(a,b){return a(b.apiUrl+"/page/random/title",{},{get:{method:"get"}})}]).factory("WikiPage",["$resource","Config",function(a,b){return a(b.apiUrl+"/page/html/:title",{},{get:{cache:!0,method:"get",transformResponse:function(a){var b={};return b.html=a,b}}})}]),angular.module("urbnApp").directive("a",["$location",function(a){return{restrict:"E",link:function(b,c,d){function e(c){c.preventDefault();var d=f.substr(2);a.search("title",btoa(d)),b.$apply()}var f=d.href;"mw:WikiLink"===d.rel&&f.indexOf(":")<0&&f.indexOf("#")<0&&"./"===f.substr(0,2)?(c.addClass("label label-primary fixed-font"),c.on("click",e)):"undefined"!=typeof f&&"#/"===f.substring(0,2)||"undefined"!=typeof d.ngHref&&"#/"===d.ngHref.substring(0,2)||c.addClass("deactivated")}}}]),angular.module("urbnApp").directive("dynamicHtml",["$compile",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch(d.dynamicHtml,function(d){if("undefined"!=typeof d)try{a(c.contents())(b)}catch(e){alert("Error: Could not render HTML"),window.location.href="404.html"}})}}}]),angular.module("urbnApp").directive("progressTracker",function(){return{restrict:"E",scope:{stack:"="},templateUrl:"views/progressTracker.html",controller:["$scope","Config","$location",function(a,b,c){a.finished=function(){a.atFinish=!0,c.path("/finish"),c.search({})},a.goal=b.targetArticle,console.info("Psst... here's the cheat code: "+btoa(a.goal))}]}}),angular.module("urbnApp").run(["$templateCache",function(a){a.put("views/finish.html",'<div class="jumbotron"> <h1>Congrats, you made it!</h1> </div> <div class="row marketing text-center"> <p class="h1"> It took you {{ solution.length }} clicks: </p> <div ng-repeat="node in solution"> <p class="h3">{{ $index +1 }}. {{ node.title | pretty }}</p> </div> <br><hr> <a class="btn btn-success" href="#/">Play Again <span class="glyphicon glyphicon-repeat"></span></a> </div>'),a.put("views/main.html",'<div class="jumbotron"> <h1>{{ gameName }}</h1> <p>This game is all about navigating through Wikipedia articles.</p> <p class="lead">Find your way to the <span class="h2">{{ goal }}</span> article in the fewest clicks possible.</p> <p>You will start on a random page. Navigate by clicking <a class="label label-primary fixed-font" href="#/" uib-popover="Yeah, just like that!" popover-trigger="\'click\'" popover-placement="right" popover-append-to-body="true">these things</a> </p> <!--    <p>You only have 5 clicks, so don\'t waste them.</p>--> <p>Good luck!</p> <a class="btn btn-lg btn-success" ng-href="{{ playBtnUrl }}" ng-disabled="!ready"> Play <span class="glyphicon glyphicon-ok"></span> </a> </div>'),a.put("views/progressTracker.html",'<div> <!--        TODO: display some loading feedback --> <!--        TODO: add api call to popover with meta data lookup... --> <p class="h3 text-center"> Articles </p> <hr> <div ng-repeat="node in stack track by $index" class="text-center"> <span ng-if="node.title === goal"> <span ng-init="finished()">You made it!</span> </span> <div ng-if="node.title !== goal"> <!-- display a button for each article in the list history. add orange styling to the active article. add $index to button text. show full article name on button hover. --> <button class="btn col-xs-12" uib-popover="{{ node.title }}" popover-trigger="\'mouseenter\'" popover-placement="right" popover-append-to-body="true" ng-class=" {\'btn-default\': !$last, \'btn-warning\': $last} "> {{ $index + 1}}. {{ node.title | pretty }} </button> <span class="glyphicon glyphicon-arrow-down"></span> </div> </div> <p ng-hide="atFinish" class="text-center"> <!-- user is not at the end, display a ??? button and disable it --> <button class="btn btn-default col-xs-12" ng-disabled="true"> ??? </button> <span class="glyphicon glyphicon-arrow-down"></span> </p> <button class="btn btn-success col-xs-12" uib-popover="{{ target }}" popover-trigger="\'mouseenter\'" popover-placement="right" popover-append-to-body="true"> {{ goal | pretty }}</button> <br> <hr> </div>'),a.put("views/wikiGame.html",'<div> <div class="col-xs-3 app-container sidebar-nodes shadow"> <!-- sidebar that tracks viewed articles --> <progress-tracker stack="history"></progress-tracker> </div> <div class="col-xs-9 app-container shadow"> <a class="btn btn-danger pull-right" href="#/">Start Over <span class="glyphicon glyphicon-repeat"></span></a> <!-- article title --> <p class="h2">{{ article.title | pretty }} </p> <hr> <!-- html viewport --> <div ng-bind-html="article.html" dynamic-html="article.html"></div> </div> </div>')}]);